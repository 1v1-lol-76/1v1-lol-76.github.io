$("#left").html("");var gamemode="",canliskor=0;function soketle(t){console.log("socket is open")}function puanKaydet(t,e,n,i,a){$(".saveScore").attr("onclick","");a={oyuncu:t,puan:e,time:n,oldurulen:i,skor:a};jQuery.ajax({type:"POST",url:"saveScore.py",data:a,success:function(n){var i=n.split("|");0==i[0]?(alert(i[1]),s_saved(),$(".saveScore").attr("onclick","")):(s_saved(),$(".saveScore").attr("onclick",""),soketle("<div style='color:green'><b>"+t+"</b> saved score: <b>"+e+"</b></div>"))}})}var ulke=$("#myUlke").val();function isEmpty(t){return!t||/^\s*$/.test(t)}function timePressCheck(){let t=new Date;return Math.floor(t.getTime()-window.lastTimePress.getTime())>=14e3/game_speed}function timePressSet(){let t=new Date;window.lastTimePress.setTime(t.getTime())}window.lastTimePress=new Date,ts=+Cookies.get("paperio_topscore"),isNaN(ts)&&(ts=0);var myScore=0,top_sco_re=ts,my_sco_re=0,game_timer=0,game_timer_c=0,killed_other=0,killed_total=0,grid_width=90,grid_height=70,game_timer_0=+new Date;function game_is_over_main(){if("paper2"==game_mode){var t=window.paper2_results;window.paper2_results.win,playtime=t.time/1e3,playtime_m=Math.floor(playtime/60),playtime_m<10&&(playtime_m="0"+playtime_m),playtime_s=Math.floor(playtime-60*playtime_m),playtime_s<10&&(playtime_s="0"+playtime_s),new_top=t.newBest,top_sco_re=t.best,my_sco_re=t.score,killed_other=t.kills}else game_timer_2=+new Date,playtime=Math.floor((game_timer_2-game_timer)/1e3),playtime_m=Math.floor(playtime/60),playtime_m<10&&(playtime_m="0"+playtime_m),playtime_s=Math.floor(playtime-60*playtime_m),playtime_s<10&&(playtime_s="0"+playtime_s),my_sco_re>top_sco_re?(top_sco_re=my_sco_re,new_top=!0):new_top=!1,Cookies.set("paperio_topscore",top_sco_re,{expires:30});$("#game_over").empty(),$(".main2").hide().fadeIn(1e3),$('<div class="gameover"></div>').appendTo("#game_over"),$('<div class="go_sc">YOUR SCORE:</div>').appendTo("#game_over").hide().delay(1e3).fadeIn(1e3),$('<div class="da_sc">'+my_sco_re.toFixed(2)+"%</div>").appendTo("#game_over").hide().delay(1e3).fadeIn(1e3),new_top?$('<div class="go_bs"><span>NEW </span>BEST SCORE:</div>').appendTo("#game_over").hide().delay(1500).fadeIn(1e3):$('<div class="go_bs">BEST SCORE:</div>').appendTo("#game_over").hide().delay(1500).fadeIn(1e3),$('<div class="da_bs">'+top_sco_re.toFixed(2)+"%</div>").appendTo("#game_over").hide().delay(1500).fadeIn(1e3),$('<div class="go_pt">TIME PLAYED:</div>').appendTo("#game_over").hide().delay(2e3).fadeIn(1e3),$('<div class="da_pt">'+playtime_m+":"+playtime_s+"</div>").appendTo("#game_over").hide().delay(2e3).fadeIn(1e3),$('<div class="go_pk">PLAYERS KILLED:</div>').appendTo("#game_over").hide().delay(2500).fadeIn(1e3),$('<div class="da_pk">'+killed_other+"</div>").appendTo("#game_over").hide().delay(2500).fadeIn(1e3),$("#game_over").show(),$(".animiescontainer").show(),olduk();var e=killed_other;0==e&&(e=1),myScore=my_sco_re;var n=Math.floor(499*Math.random()+1),i=myScore.toFixed(2)*e*(15e3/playtime.toFixed(0)),a=$("#nickname").val();""==a&&(a="paperio.cafe_"+n),soketle("<div style='color:red'><b>"+a+"</b> is died, Score: <b>"+i.toFixed(0)+"</b></div>"),$("#minimap").hide(),$(".saveScore").attr("onclick","puanKaydet('"+a+"','"+i.toFixed(2)+"','"+playtime_m+":"+playtime_s+"','"+killed_other+"','"+myScore.toFixed(2)+"')")}var newgame_loaded=null;function showLoad(){$(".play").hide(),$(".loader").show(),$(".mode").addClass("disabled"),setTimeout(showResetUI,1e4)}function showResetUI(){$(".noConnectBtn").show(),$(".noConnectText").show()}var canliisim="xxx";function game_start(t){if($(".animiescontainer").hide(),"paperio.cafe"==window.location.host){if(!1===newgame_loaded)return;newgame_loaded=!0,modesReady=!0,"undefined"!=typeof afg_do?afg_do():game_starter()}else alert("server error!")}function game_starter(t=!1){if("paper2"!=game_mode)if(newgame_loaded&&modesReady){newgame_loaded=null;var e=parseFloat(document.body.style.zoom);window.addWidth=.5*document.body.clientWidth*e-.5*document.body.clientWidth,!0===window.obstaclesOn&&obstaclesMake(),grid_scale=1,prev_scale=1,$("#left").hide(),$("#right").hide(),$("#bottom").hide(),$("#share").hide(),$("#links").hide(),$("#cpmstar_anchor").hide(),$("div").each((function(t){100!=this.style.zIndex||"0px"!=this.style.left&&"0px"!=this.style.right||(this.style.display="none")})),pause=!1,game_timer=+new Date,game_timer_c=0,killed_other=0,killed_total=0}else window.setTimeout(game_starter,100);else window.paper2?($(".main").hide(),$(".main2").hide(),$("#game_over").hide(),window.paper2.start()):window.setTimeout(game_starter,100)}function resetPage(){location.reload()}function screen_sizes(){"blocks"!=game_mode&&($("#paperio #outer_grid").css({width:30*grid_width+$("#paperio").width(),height:30*grid_height+$("#paperio").height()}),$("#paperio #grid").css({width:30*grid_width,height:30*grid_height,left:$(window).width()/2/document.body.style.zoom,top:$("#paperio").height()/2}))}function setZoom(){0==$(".grow").is(":visible")&&0==$("#game_over").is(":visible")?(document.body.style.zoom=1/window.devicePixelRatio,screen_sizes()):document.body.style.zoom=1}$("#nickname").on("keyup",(function(t){13==t.keyCode&&$(".main").is(":visible")&&$(".playButon").trigger("click")})),$(document).ready((function(){})),$(window).on("resize",(function(){}));var game_challenge=0,obstaclesOn=!1,game_speed=500,mpd=0,spd=800;function serverSelect(t,e){if(spd="ffa"==t?800:"speed"==t?1600:"jet"==t?3e3:800,game_mode=e,$(".selectedServer").html(t),"paper2"===game_mode)Path2D||$(".play").hide();window.game_speed=game_speed}!function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?o(t):e}function h(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c,u,d,f,p,m,v,y,g=Math.pow(2,-26),k=function(t){return Math.abs(t)<=g},b=function(t,e){return Math.abs(t-e)<=g},w=function(t,e,n,i){return t*i-e*n},x=function(t,e,n){return Math.min(t,e)-g<=n&&n<=Math.max(t,e)+g},M=function(t,e,n,i){var a;return e<t&&(a=t,t=e,e=a),i<n&&(a=n,n=i,i=a),Math.min(e,i)-Math.max(t,n)},_=performance||Date,S=_.now.bind(_),T=1,E=function(t,e,n,i){for(var a=2*Math.PI,s=a/n,r=[],o=0;o<a-g;o+=s)r.push(new P(t+Math.cos(o)*i,e+Math.sin(o)*i));return r},q=function(t,e,n){return"#".concat(function(t){var e="";return t.forEach((function(t){var n=t.toString(16);e+=n.length<2?"0".concat(n):n})),e}(function(t){var e,n,i,a,s,r,o,l,h=t.h,c=t.s,u=t.v;if(h=Math.max(0,Math.min(360,h)),c=Math.max(0,Math.min(100,c)),u=Math.max(0,Math.min(100,u)),u/=100,0==(c/=100))return e=n=i=u,[Math.round(255*e),Math.round(255*n),Math.round(255*i)];switch(r=u*(1-c),o=u*(1-c*(s=(h/=60)-(a=Math.floor(h)))),l=u*(1-c*(1-s)),a){case 0:e=u,n=l,i=r;break;case 1:e=o,n=u,i=r;break;case 2:e=r,n=u,i=l;break;case 3:e=r,n=o,i=u;break;case 4:e=l,n=r,i=u;break;default:e=u,n=r,i=o}return[Math.round(255*e),Math.round(255*n),Math.round(255*i)]}({h:t,s:e,v:n})))},P=function(){function t(n,i){e(this,t),this.cell=null,this.segments=[],this.set(n,i)}return i(t,[{key:"set",value:function(t,e){return this.x=t||0,this.y=e||(0===e?0:this.x),this}},{key:"commit",value:function(e){if(-1===this.segments.indexOf(e)&&this.segments.push(e),!this.cell){var n=t.space.cell(this);n.commit(this),this.cell=n}}},{key:"remove",value:function(t){var e=this.segments.indexOf(t);this.segments.splice(e,1),this.cell&&!this.segments.length&&this.cell.remove(this)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"mul",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"mulScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"magnitude",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"normalize",value:function(){var t=this.magnitude();return t&&this.mulScalar(1/t),this}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"distance",value:function(t){return Math.sqrt(this.distance2(t))}},{key:"distance2",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"rotate",value:function(t){var e=this.x,n=this.y,i=Math.cos(t),a=Math.sin(t);return this.x=e*i-n*a,this.y=e*a+n*i,this}},{key:"angle",value:function(t){return Math.atan2(this.x*t.y-t.x*this.y,this.dot(t))}},{key:"invert",value:function(){return this.mulScalar(-1)}},{key:"equal",value:function(t){return b(this.x,t.x)&&b(this.y,t.y)}}]),t}(),C=function(){function t(n,i){e(this,t),this.points=[],this.x=n,this.y=i}return i(t,[{key:"commit",value:function(t){this.points.push(t)}},{key:"remove",value:function(t){var e=this.points,n=e.indexOf(t);-1!==n&&e.splice(n,1)}}]),t}(),I=function(){function t(n,i,a){e(this,t),this.width=n,this.height=i,this.center=new P(n/2,i/2),this.size=a,this.w=Math.ceil(n/a),this.h=Math.ceil(i/a),this.cells=[];for(var s=0;s<this.h;s++)for(var r=0;r<this.w;r++)this.cells.push(new C(r,s))}return i(t,[{key:"count",value:function(){var t=0;return this.cells.forEach((function(e){t+=e.points.length})),t}},{key:"cell",value:function(t){return this.getCell(Math.floor(t.x/this.size),Math.floor(t.y/this.size))}},{key:"getCell",value:function(t,e){return this.cells[t+e*this.w]}},{key:"checkPoint",value:function(t){return this.cell(t).points.find((function(e){return e.equal(t)}))||t}},{key:"segmentsCount",value:function(){for(var t={},e=0;e<this.h;e++)for(var n=0;n<this.w;n++)this.getCell(n,e).points.forEach((function(e){e.segments.forEach((function(e){return t[e.id]=e}))}));return t}},{key:"intersections",value:function(t){for(var e=this.cell(t.start),n=this.cell(t.end),i=Math.min(e.x,n.x),a=Math.max(e.x,n.x),s=Math.min(e.y,n.y),r=Math.max(e.y,n.y),o=T++,l=[],h=s;h<=r;h++)for(var c=i;c<=a;c++)this.getCell(c,h).points.forEach((function(t){t.segments.forEach((function(t){t.mark!==o&&(l.push(t),t.mark=o)}))}));var u=[];return l.forEach((function(e){var n=e.intersect(t);n&&u.push(n)})),u}}]),t}(),O=function(){function t(n,i){e(this,t),n.equal(i),this.mark=0,this.shape=null,this.start=n,this.end=i,this.calc()}return i(t,[{key:"calc",value:function(){var t=this.start,e=this.end;this.vector=e.clone().sub(t);var n=t.y-e.y,i=e.x-t.x,a=Math.sqrt(n*n+i*i);n/=a,i/=a,this.a=n,this.b=i,this.c=-(n*t.x+i*t.y)}},{key:"clone",value:function(){return new t(this.start,this.end)}},{key:"reverse",value:function(){var t=this.start;return this.start=this.end,this.end=t,this.calc(),this}},{key:"commit",value:function(t){return this.shape=t,this.start.commit(this),this.end.commit(this),this}},{key:"remove",value:function(){this.shape=null,this.start.remove(this),this.end.remove(this)}},{key:"length",value:function(){return this.vector.magnitude()}},{key:"zn",value:function(t){var e=t.a,n=t.b,i=this.a,a=this.b;return w(e,n,i,a)}},{key:"intersect",value:function(t){var e=t.a,n=t.b,i=t.c,a=t.start,s=t.end,r=this.a,o=this.b,l=this.c,h=this.start,c=this.end,u=w(e,n,r,o);if(!k(u)){var d=-w(i,n,l,o)/u,f=-w(e,i,r,l)/u,p=x(a.x,s.x,d)&&x(a.y,s.y,f)&&x(h.x,c.x,d)&&x(h.y,c.y,f)&&new P(d,f);return!!p&&{point:h.equal(p)&&h||c.equal(p)&&c||a.equal(p)&&a||s.equal(p)&&s||p,segment:this,distance:p.distance2(a),overlay:!1,zn:Math.sign(u)}}var m=M(a.x,s.x,h.x,c.x),v=M(a.y,s.y,h.y,c.y);if(k(w(e,i,r,l))&&k(w(n,i,o,l))&&-g<=m&&-g<=v){var y;if(g<=m||g<=v)return{point:y=x(h.x,c.x,a.x)&&x(h.y,c.y,a.y)?h.equal(a)&&h||c.equal(a)&&c||a:a.distance2(h)>=a.distance2(c)?c:h,segment:this,distance:y.distance2(a),overlay:!0,zn:0};var b=h.equal(a)||h.equal(s)?h:c;return{point:b,segment:this,distance:b.distance2(a),overlay:!1,zn:0}}return!1}},{key:"has",value:function(t){return this.start===t||this.end===t}},{key:"owner",get:function(){}}]),t}(),z=function(t,e,n){var i=t.x-n.x,a=t.y-n.y,s=e.x-n.x,r=e.y-n.y;if(0<a*r)return 1;var o=i*r-a*s,l=k(o)?0:Math.sign(o);return 0===l?i*s<=0?0:1:a<0?-l:r<0?l:1},L=function(){function t(n){e(this,t),this.segments=[],this.owner=null;for(var i=n.length,a=0;a<i;)this.segments.push(new O(n[a++],n[a<i?a:0]));this.updateBounds()}return i(t,[{key:"commit",value:function(t){var e=this;t&&(this.owner=t),this.segments.forEach((function(t){return t.commit(e)}))}},{key:"remove",value:function(){this.segments.forEach((function(t){return t.remove()}))}},{key:"reverse",value:function(){return this.segments.reverse(),this.segments.forEach((function(t){return t.reverse()})),this}},{key:"insert",value:function(t,e){if(!t.has(e)){var n=this.segments.findIndex((function(e){return e===t})),i=new O(t.start,e).commit(this),a=new O(e,t.end).commit(this);t.remove(),this.segments.splice(n,1,i,a)}}},{key:"hasPoint",value:function(t){return this.segments.some((function(e){return e.has(t)}))}},{key:"findSegment",value:function(t){return this.segments.findIndex((function(e){return e.start===t}))}},{key:"splice",value:function(t,e,n){var i;(i=this.segments).splice.apply(i,[e,n-e].concat(h(t.segments))).forEach((function(t){return t.remove()})),t.commit(this)}},{key:"unsplice",value:function(t,e,n){var i=this.segments.splice(e,n-e);this.remove(),this.segments=i.concat(t.reverse().segments),t.commit(this)}},{key:"left",value:function(t,e,n){for(var i,a=this,s=[],r=0;r<t.length-1;r++)s.push(new O(t[r],t[r+1]));var o=(i=this.segments).splice.apply(i,[e,n-e].concat(s));s.forEach((function(t){return t.commit(a)})),o.forEach((function(t){return t.remove()}))}},{key:"right",value:function(t,e,n){for(var i=this,a=[],s=0;s<t.length-1;s++)a.push(new O(t[s],t[s+1]));var r=this.segments.splice(e,n-e);this.remove(),a.reverse().forEach((function(t){return t.reverse().commit(i)})),this.segments=r.concat(a)}},{key:"points",value:function(){return this.segments.map((function(t){return t.start}))}},{key:"intersections",value:function(t){var e=[];return 1<this.segments.length&&this.segments.forEach((function(n){var i=n.intersect(t);i&&e.push(i)})),e.sort((function(t,e){return t.distance-e.distance})),e}},{key:"inside",value:function(t){for(var e=this.segments.length,n=1,i=0;i<e;i++){var a=this.segments[i],s=a.start,r=a.end,o=z(s,r,t);if(0===o)return!0;n*=o}return 1!==n}},{key:"rawSquare",value:function(){var t=0;return this.segments.forEach((function(e){var n=e.start,i=e.end;t+=(n.x+i.x)*(i.y-n.y)})),t/2}},{key:"square",value:function(){var t=this.rawSquare();return t<0&&(t*=-1),t}},{key:"calcPath",value:function(){var t=new Path2D,e=this.segments,n=e.length,i=e[0].start;t.moveTo(i.x,i.y);for(var a=1;a<n;a++){var s=e[a].start;t.lineTo(s.x,s.y)}t.closePath(),this.path=t,this.updateBounds()}},{key:"updateBounds",value:function(){var t=1/0,e=-1/0,n=1/0,i=-1/0;this.segments.forEach((function(a){var s=a.start,r=s.x,o=s.y;t=Math.min(t,r),e=Math.max(e,r),n=Math.min(n,o),i=Math.max(i,o)})),this.bounds={left:t,right:e,top:n,bottom:i}}}]),t}(),j=function(){function t(n,i){if(e(this,t),!n){var a=window.innerWidth/2,s=window.innerHeight/2,r=.85*Math.min(a,s),o=2*Math.PI,l=o/200;n=[];for(var h=0;h<o-g;h+=l)n.push(new P(a+Math.cos(h)*r,s+Math.sin(h)*r))}this.radius=i,this.polygon=new L(n)}return i(t,[{key:"intersections",value:function(t){return this.polygon.intersections(t).filter((function(t){return!t.overlay}))}}]),t}(),R=function(){function t(n,i,a,s,r,o,l){e(this,t),this.text=n,this.color=i,this.unit=a,this.position=s,this.velocity=r,this.duration=o,this.time=o,this.fading=l}return i(t,[{key:"update",value:function(t){this.time-=t,0<this.time&&this.position.add(this.velocity.clone().mulScalar(t/1e3))}},{key:"draw",value:function(t,e){var n,i=Math.floor((n=this.time/this.duration)*n*n*(n*(6*n-15)+10)*255).toString(16);i.length<2&&(i="0"+i);var a=this.unit?this.unit.position.clone().add(this.position):this.position,s=~~(38/window.devicePixelRatio);t.fillStyle="#000",t.font="bold ".concat(s,"px arial"),t.textAlign="center",t.textBaseline="middle",t.fillText(this.text,a.x*e,a.y*e)}}]),t}(),B=((c=new Path2D).moveTo(-1,-1),c.lineTo(1,-1),c.lineTo(1,1),c.lineTo(-1,1),c.closePath(),c),D=function(){function t(n,i,a,s,r,o,l,h){e(this,t),this.color=n,this.position=i,this.velocity=a,this.acceleration=h,this.rotate=s,this.scale=r,this.vscale=o,this.rotation=Math.random()*Math.PI*2,this.time=l}return i(t,[{key:"update",value:function(t){this.time-=t;var e=t/1e3;0<this.time&&(this.acceleration&&this.velocity.add(this.acceleration.clone().mulScalar(e)),this.position.add(this.velocity.clone().mulScalar(e)),this.rotation+=this.rotate*e,this.scale+=this.vscale*e)}},{key:"draw",value:function(t){var e=this.position,n=e.x,i=e.y,a=this.rotation,s=this.color,r=this.scale;t.save(),t.translate(n,i),t.rotate(a),t.scale(r,r),t.fillStyle=s,t.fill(B),t.restore()}}]),t}(),A=function(){function t(n,i){var a=this;e(this,t),this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.modifiers={shift:!1,ctrl:!1,alt:!1,meta:!1},this.mouse=null,this.lastMouse=null,this.buttons={left:!1,middle:!1,right:!1},(this.keyboardModeSwitch=i).get();var s=function(t){return t.preventDefault()};n.addEventListener("contextmenu",s,!1);var r=function(t){return a.onKeyChange(t,!0)},o=function(t){return a.onKeyChange(t,!1)};window.addEventListener("keydown",r,!1),window.addEventListener("keyup",o,!1);var l=function(t){return a.onMouseChange(t,!0)},h=function(t){return a.onMouseChange(t,!1)},c=function(){a.lastMouse=a.mouse,a.mouse=null},u=function(t){null===a.mouse&&(a.mouse={}),a.mouse.x=t.pageX,a.mouse.y=t.pageY},d=function(t){u(t);var e=t.buttons;a.buttons={left:!!(1&e),middle:!!(4&e),right:!!(2&e)}};n.addEventListener("mouseenter",d,!1),n.addEventListener("mousemove",u,!1),n.addEventListener("mouseleave",c,!1),n.addEventListener("mousedown",l,!1),n.addEventListener("mouseup",h,!1);var f=function(){a.lastMouse=a.mouse,a.mouse=null},p=function(t){null===a.mouse&&(a.mouse={});var e=t.changedTouches[0];a.mouse.x=e.clientX,a.mouse.y=e.clientY};n.addEventListener("touchstart",p,!1),n.addEventListener("touchmove",p,!1),n.addEventListener("touchend",f,!1),n.addEventListener("touchcancel",f,!1),this.dispose=function(){n.removeEventListener("contextmenu",s,!1),window.removeEventListener("keydown",r,!1),window.removeEventListener("keyup",o,!1),n.removeEventListener("mouseenter",d,!1),n.removeEventListener("mousemove",u,!1),n.removeEventListener("mouseleave",c,!1),n.removeEventListener("mousedown",l,!1),n.removeEventListener("mouseup",h,!1),n.removeEventListener("touchstart",touchHandler,!1),n.removeEventListener("touchmove",touchHandler,!1)}}return i(t,[{key:"pressed",value:function(){return this.up||this.down||this.left||this.right}},{key:"onKeyChange",value:function(t,e){if(t.target===document.body){switch(t.keyCode){case 38:case 87:this.up=e;break;case 40:case 83:this.down=e;break;case 37:case 65:this.left=e;break;case 39:case 68:this.right=e;break;case 67:e||this.keyboardModeSwitch.switch()}this.modifiers.shift=t.shiftKey,this.modifiers.ctrl=t.ctrlKey,this.modifiers.alt=t.altKey,this.modifiers.meta=t.metaKey}}},{key:"onMouseChange",value:function(t,e){switch(t.button){case 0:this.buttons.left=e;break;case 1:this.buttons.middle=e;break;case 2:this.buttons.right=e}}}]),t}(),F={baseRadius:180,baseCount:60,minScale:.3,maxScale:.6,trackWidth:60,unitSpeed:290,spawnTimeout:3e3,prepareCounter:1e3,baseHeight:2},W=function(t,e,n){t.fillStyle=n,t.fill(e)},K=function(t,e,n,i,a){var s=e.polygon.path;t.fillStyle=i,t.fill(s)},H=function(t,e,n,i,a,s){var r=F.trackWidth;n.polyline.segments.length&&(t.lineWidth=r+(a?2:0),t.strokeStyle=e,t.stroke(n.polyline.path))},U=((d=new Path2D).moveTo(-24,-24),d.lineTo(-8,-8),d.lineTo(0,-24),d.lineTo(8,-8),d.lineTo(24,-24),d.lineTo(16,8),d.lineTo(-16,8),d.closePath(),d),J=((f=new Path2D).moveTo(0,-14),f.lineTo(10,-12),f.lineTo(14,-6),f.lineTo(12,4),f.lineTo(8,6),f.lineTo(6,12),f.lineTo(0,14),f.lineTo(-6,12),f.lineTo(-8,6),f.lineTo(-12,4),f.lineTo(-14,-6),f.lineTo(-10,-12),f.closePath(),f.arc(-6,-2,4,0,2*Math.PI,!0),f.closePath(),f.arc(6,-2,4,0,2*Math.PI,!0),f.closePath(),f.moveTo(0,2),f.lineTo(-4,6),f.lineTo(0,8),f.lineTo(4,6),f.closePath(),function(t,e,n){var i=F.trackWidth;if(n.image){var a=n.image.naturalWidth||n.image.width,s=n.image.naturalHeight||n.image.height,r=i*e.skin.avatar.scale*n.scale/a;t.save(),t.translate(e.position.x,e.position.y-F.baseHeight*n.level),t.rotate(e.direction+Math.PI/2),t.translate((e.skin.avatar.x+n.x)*i,(e.skin.avatar.y+n.y)*i);var o=0;if("target"===n.direction){var l=e.target.clone().sub(e.position);o+=Math.atan2(l.y,l.x)-e.direction}"billboard"===n.direction&&(o+=-e.direction-Math.PI/2),n.rotation&&(o+=.0174533*n.rotation),o&&t.rotate(o),t.drawImage(n.image,a*r*-n.pivot.x,s*r*-n.pivot.y,a*r,s*r),t.restore()}}),N=function(){function t(n,i){e(this,t),this.unit=n,this.merges=[],this.polygon=new L(i),this.polygon.commit(this),this.calcSquare(),this.polygon.calcPath()}return i(t,[{key:"calcPath",value:function(){this.path=new Path2D;var t=this.polygon.segments,e=t.length,n=t[0].start;this.path.moveTo(n.x,n.y);for(var i=1;i<e;i++){var a=t[i].start;this.path.lineTo(a.x,a.y)}return this.path.closePath(),this.path}},{key:"calcSquare",value:function(){this.square=this.polygon.square()}},{key:"remove",value:function(){this.polygon.remove()}},{key:"handleIntersect",value:function(t,e,n,i){e===this.unit?this.handleSelfIntersect(t,e,n,i):this.handleEnemyIntersect(t,e,n,i)}},{key:"handleSelfIntersect",value:function(t,e,n,i){if(!t.overlay){var a=t.point,s=t.segment;if(e.in===this){if(t.zn<0)return;if(a.equal(n.end))return;this.polygon.insert(s,a),e.track.polyline.add(a),e.in=null}else{if(0<t.zn)return;if(a.equal(n.start))return;if(e.in)return;this.polygon.insert(s,a),e.track.polyline.add(a),e.track.polyline.end&&i.handleReturn(e),e.in=this,e.track.remove()}}}},{key:"handleEnemyIntersect",value:function(t,e,n,i){var a=t.point,s=t.segment;if(e.in===this){if(t.zn<0)return;this.polygon.insert(s,a),e.track.polyline.add(a),e.track.intersect(t,this,!1),e.in=null}else{if(0<t.zn)return;if(t.overlay)return;if(a.equal(n.end))return;if(e.in)return;this.polygon.insert(s,a),e.track.polyline.add(a),e.track.intersect(t,this,!0),e.in=this}}}]),t}(),Y=function(){function t(n){e(this,t),this.owner=n||null,this.start=null,this.end=null,this.segments=[],this.bounds={left:1/0,right:-1/0,top:1/0,bottom:-1/0},this.path=new Path2D}return i(t,[{key:"commit",value:function(t){this.segments.forEach((function(e){return e.commit(t)}))}},{key:"remove",value:function(){this.segments.forEach((function(t){return t.remove()}))}},{key:"reverse",value:function(){if(this.segments.reverse().forEach((function(t){return t.reverse()})),this.end){var t=this.start;this.start=this.end,this.end=t}return this}},{key:"clone",value:function(){var e=new t;return e.segments=this.segments.map((function(t){return t.clone()})),e.start=this.start,e.end=this.end,Object.assign(e.bounds,this.bounds),e}},{key:"updateBounds",value:function(t){var e=t.x,n=t.y;this.bounds.left=Math.min(this.bounds.left,e),this.bounds.right=Math.max(this.bounds.right,e),this.bounds.top=Math.min(this.bounds.top,n),this.bounds.bottom=Math.max(this.bounds.bottom,n)}},{key:"add",value:function(t){var e=this.end||this.start;if(!e||!e.equal(t)){var n=t.x,i=t.y;if(this.end)return this.segments.push(new O(this.end,t).commit(this)),this.end=t,this.updateBounds(t),void this.path.lineTo(n,i);if(this.start)return this.segments.push(new O(this.start,t).commit(this)),this.end=t,this.updateBounds(t),void this.path.lineTo(n,i);this.start=t,this.updateBounds(t),this.path.moveTo(n,i)}}},{key:"points",value:function(){var t=this.segments.map((function(t){return t.start}));return this.end&&t.push(this.end),t}}]),t}(),G=function(){function t(n){e(this,t),this.polyline=new Y(this),this.unit=n,this.intersections=[],this.isTrack=!0}return i(t,[{key:"intersect",value:function(t,e,n){var i=this.intersections.find((function(e){return e.point.equal(t.point)}));i?i.intersections.push({intersection:t,base:e,enter:n}):this.intersections.push({point:t.point,intersections:[{intersection:t,base:e,enter:n}]})}},{key:"remove",value:function(){this.polyline.remove(),this.polyline=new Y(this),this.intersections=[]}},{key:"handleIntersect",value:function(t,e,n,i){e===this.unit?!0!==t.overlay&&t.point===this.polyline.segments[this.polyline.segments.length-1].end||(this.unit.position=t.point,i.kill(this.unit)):i.kill(this.unit,e)}},{key:"owner",get:function(){}}]),t}(),X=function(){function t(n,i,a){e(this,t),this.states=n,this.state="",this.payload=a,this.context={},this.change(i)}return i(t,[{key:"change",value:function(t){var e=this.states[this.state];e&&e.leave&&(this.context=e.leave(this.payload,this.context)||this.context);var n=this.states[t];n&&(this.state=t,this.context=n.enter&&n.enter(this.payload,this.context)||this.context,this.update())}},{key:"update",value:function(){var t=this.states[this.state],e=t&&t.update(this.payload,this.context);e&&this.change(e)}}]),t}(),Q={idle:{update:function(){return Math.random()<.25?"cut":"exit"}},cut:{enter:function(t){var e=t.position.clone().sub(t.game.space.center),n=e.magnitude(),i=new O(t.position,e.normalize().mulScalar(t.game.border.radius-n+10).add(t.position)),a=t.base.polygon.intersections(i),s={};return s.exitPoint=a.sort((function(t,e){return t.distance-e.distance}))[0].point,s},update:function(t,e){if(t.in!==t.base)return"capture";var n=t.position.distance(t.game.space.center);if(t.game.border.radius-n<1)return"idle";t.target=e.exitPoint}},exit:{enter:function(t){var e,n={},i=1/0,a=t.base.polygon.segments.length,s=F.unitSpeed;for(n.minDistance=s;void 0===e;){for(var r=0;r<1;r++){var o=~~(Math.random()*a),l=t.base.polygon.segments[o].start.distance(t.position);l<i&&s<l&&(i=l,e=o)}s*=.75}return n.exitPoint=t.base.polygon.segments[e].start,n},update:function(t,e){if(t.in!==t.base)return"capture";var n=t.base.polygon.segments.length,i=e.minDistance,a=~~(Math.random()*n),s=t.base.polygon.segments[a].start,r=s.distance(t.position),o=e.exitPoint.distance(t.position);i<r&&r<o?e.exitPoint=s:(Object.values(e.exitPoint.segments).some((function(e){return e&&e.shape===t.base.polygon}))||(e.exitPoint=s),t.target&&t.target.distance(t.game.space.center)>t.game.border.radius-1&&(e.exitPoint=s)),t.target=e.exitPoint}},capture:{enter:function(t,e){var n=e.exitPoint,i=F.unitSpeed,a=t.base.polygon.segments,s=(1+Math.random())*i,r=Math.sign(Math.random()-.5)||1,o=0,l=a.findIndex((function(t){return t.start.equal(n)}));if(-1===l){var h=1/0,c=0;if(a.forEach((function(e,n){var i=e.start.distance2(t.position);i<h&&(h=i,c=n)})),n=a[c].start,e.exitPoint=n,-1===(l=a.findIndex((function(t){return t.start.equal(n)}))))throw console.log("exitPoint",n),new Error("Сегмент не найден. Баг в грязном хаке!!!")}for(var u=!1;o<s;){if(o=a[l].start.distance(n),(l+=r)>=a.length){if(l=0,u)break;u=!0}if(l<0){if(l=a.length-1,u)break;u=!0}}var d=a[l].start,f=d.clone().sub(n),p=n.clone().add(f.clone().mulScalar(.5)),m=(.5+Math.random())*i,v=f.clone().rotate(-r*Math.PI/2).normalize().mulScalar(m),y=p.add(v);t.target=y,e.targets=[d],e.sign=r,e.returnPoint=d},update:function(t,e){if(t.in===t.base)return"idle";if(!Object.values(e.returnPoint.segments).some((function(e){return e&&e.shape===t.base.polygon})))return"back";if(t.game.units.some((function(e){return e!==t&&t.position.distance(e.position)<F.unitSpeed})))return"back";if(t.target.distance(t.game.space.center)>t.game.border.radius+18)return"back";if(t.position.distance2(t.target)<400){var n=e.targets.shift();if(!n)return"back";t.target=n}}},back:{enter:function(t,e){var n=t.base.polygon.segments,i=e.exitPoint,a=e.sign,s=1/0,r=0;n.forEach((function(e,n){var i=e.start.distance2(t.position);i<s&&(s=i,r=n)}));var o=n[r].start;if(i)for(;o.distance2(i)<100;)(r+=a)>=n.length&&(r=0),r<0&&(r=n.length-1),o=n[r].start;t.target=o},update:function(t,e){if(t.in===t.base)return"idle"}}},V=function(){function t(n,i,a,s){e(this,t),this.name=n,this.direction=0,this.position=i,this.base=new N(this,a),this.skin=s,this.lastSquare=this.base.square,this.in=this.base,this.track=new G(this),this.target=null,this.respawn=!1,this.statistics={kills:0}}return i(t,[{key:"movement",value:function(){return this.target&&this.target.clone().sub(this.position).normalize()}},{key:"speed",get:function(){}}]),t}(),Z=function(t){function n(t,i,a,r){var o;return e(this,n),(o=l(this,s(n).call(this,t,i,a,r))).lastSquare=o.base.square,o}return a(n,V),i(n,[{key:"update",value:function(t){this.respawn||(this.target=t.direction.clone().mulScalar(50).add(this.position))}}]),n}(),tt=function(t){function n(t,i,a,r,h){var c;return e(this,n),(c=l(this,s(n).call(this,t,a,r,h))).targets=[],c.game=i,c.fsm=new X(Q,"exit",o(c)),c}return a(n,V),i(n,[{key:"update",value:function(){this.fsm.update()}}]),n}(),et=Math.cos(0),nt=Math.sin(0),it=function(t){var e=Math.cos(t),n=Math.sin(t);return new P(et*e-nt*n,et*n+nt*e)},at=function(){function n(t,i,a,s,r,o,l,h){var c=this;if(e(this,n),m=F.minScale,p=F.maxScale,v=F.trackWidth,this.azs=F.minScale,this.controller=new A(t,h),this.skinManager=s,this.nameManager=l,this.space=i,this.maxUnits=r,this.view=t,this.border=a,this.player=null,this.units=[],this.mouse=new P,this.direction=new P(1,0),this.keyboard=!1,this.fakeMouse=null,this.labels=[],this.scale=p,this.square=this.border.polygon.square(),this.gameOverCallback=o,this.actived=!1,this.needSuspendSpawn=!0,this.suspendSpawn=!1,this.generateParticles=!1,this.particles=[],this.border.polygon.calcPath(),t){var u=function(){c.view.width=window.innerWidth,c.view.height=window.innerHeight};window.addEventListener("resize",u,!1),u()}this.stats={fps:0,ut:0,ait:0,st:0,rt:0},this.timings={updateStartTime:0,updateEndTime:0,aiStartTime:0,aiEndTime:0,spawnStartTime:0,spawnEndTime:0,renderStartTime:0,renderEndTime:0}}return i(n,[{key:"addPlayer",value:function(t){this.units.push(t),this.player=t}},{key:"addUnit",value:function(t){this.units.push(t)}},{key:"getspawnPosition",value:function(t){for(var e=this.space.center,n=this.border.radius,i=2*F.baseRadius,a=i*(this.player?3-this.player.base.square/this.square*2:3),s=a*a,r=e.clone().add(new P(0,t?n-3*i+Math.random()*(2*i):Math.random()*(n-i)).rotate(Math.random()*Math.PI*2)),o=0;o<this.units.length;o++){var l=this.units[o];if(l.base.polygon.inside(r))return;if(l.base.polygon.segments.some((function(t){return r.distance2(t.start)<s})))return;if(l.track.polyline.segments.some((function(t){return r.distance2(t.start)<s})))return}return r}},{key:"spawnBot",value:function(t){var e=this;if(this.actived){if(this.suspendSpawn)return;if(this.needSuspendSpawn)return this.suspendSpawn=!0,void setTimeout((function(){e.needSuspendSpawn=!1,e.suspendSpawn=!1}),(1+Math.random())*F.spawnTimeout)}if(this.nameManager.pool.length){var n=this.getspawnPosition(t);n&&(this.addUnit(new tt(this.nameManager.get(),this,n,E(n.x,n.y,F.baseCount,F.baseRadius),this.skinManager.get())),this.needSuspendSpawn=!0,this.suspendSpawn=!1)}else this.nameManager.request()}},{key:"spawnPlayer",value:function(t,e){for(var n,i=0;!n;)50<++i&&(i=0,this.units.length&&this.kill(this.units[0])),n=this.getspawnPosition();if(n){var a=this.skinManager.get(e,!0);if(!a){var s=this.units.find((function(t){return t.skin.name===e}));s?(a=s.skin,s.skin=this.skinManager.get()):a=this.skinManager.get("",!0)}var r=Math.floor(499*Math.random()+1),o=$("#nickname").val();isEmpty(o)&&(o="paperio.cafe_"+r),canliisim=o;var l=new Z(t||o,n,E(n.x,n.y,F.baseCount,F.baseRadius),a);this.addPlayer(l),this.scale=3-l.base.square/this.square*(p-m),this.startTime=Date.now(),soketle("<div><b>"+o+"</b> is playing now.</div>"),$("#minimap").fadeIn()}}},{key:"genKillParticles",value:function(t,e,n){var i=this;if(this.generateParticles){var a=0;e.forEach((function(e){if(5<(a+=e.vector.magnitude())){a=0;var s=e.vector.clone().normalize().rotate(Math.sign(Math.random()-.5)*Math.PI/2).mulScalar(25+100*Math.random());.25<Math.random()&&s.mulScalar(.1);var r=(n?6:2)*(6+5*Math.random()),o=new D(t.skin.colors.particles[~~(Math.random()*t.skin.colors.particles.length)],e.start.clone(),s,2*Math.PI*(1+Math.random())*Math.sign(Math.random()-2.5||1),r,.9*-r,1e3);i.particles.push(o)}}))}}},{key:"gameOver",value:function(t){var e=this,n=1/0,i=0,a=1/0,s=0;this.player.base.polygon.segments.forEach((function(t){var e=t.start,r=e.x,o=e.y;n=Math.min(n,r),i=Math.max(i,r),a=Math.min(a,o),s=Math.max(s,o)}));var r=i-n,o=s-a,l=Math.max(r,o),h=new P(n+r/2,a+o/2),c=475/l,u=document.createElement("canvas");u.width=500,u.height=500;var d=u.getContext("2d");d.scale(c,c),d.translate(250/c-h.x,250/c-h.y),d.translate(0,5/c),W(d,this.player.base.polygon.path,this.player.skin.colors.back),d.translate(0,-10/c),W(d,this.player.base.polygon.path,this.player.skin.pattern||this.player.skin.colors.main);var f=u.toDataURL("image/png"),p={game:this,score:t?100:this.player.base.square/this.square*100,best:this.best,time:Date.now()-this.startTime,kills:this.player.statistics.kills,image:f,win:t};setTimeout((function(){t&&e.kill(e.player,void 0,t),e.player=null,e.gameOverCallback&&e.gameOverCallback(p)}),1e3)}},{key:"kill",value:function(t,e,n){t.death=!0,this.skinManager&&this.skinManager.release(t.skin),this.units.forEach((function(e){e!==t&&e.in===t.base&&(e.in=null)})),this.genKillParticles(t,t.track.polyline.segments),this.genKillParticles(t,t.base.polygon.segments,!0),t.track.remove(),t.base.remove();var i=this.units.findIndex((function(e){return e===t}));this.units.splice(i,1),e&&(e.statistics.kills++,e===this.player&&this.labels.push(new R("Kill",t.skin.colors.main,e,new P(0,-180),new P(0,-100),1e3,!0))),n||t!==this.player||this.gameOver()}},{key:"getMovement",value:function(t,e){var n=[],i=e.movement();if(!i)return n;i.mulScalar(spd*t/1e3);var a=it(e.direction),s=Math.atan2(a.x*i.y-i.x*a.y,a.dot(i)),r=2*Math.PI*t/1e3;Math.abs(s)>r&&(s=r*Math.sign(s)),e.direction+=s;for(var o=it(e.direction).mulScalar(spd*t/1e3),l=new O(e.position,e.position.clone().add(o)),h=this.border.intersections(l);h.length;){var c=void 0,u=l.vector;if(2===h.length){var d=h[0].segment.vector;c=0<Math.atan2(u.x*d.y-d.x*u.y,u.dot(d))?h[0]:h[1]}else c=h[0];var f=c,p=f.segment,m=f.point,v=p.vector;if(Math.atan2(u.x*v.y-v.x*u.y,u.dot(v))<0)break;if(!k(c.distance)){var y=new O(l.start,m);n.push(y)}var g=(l=new O(m,l.end)).vector,b=v.clone().normalize().mulScalar(g.dot(v)/v.magnitude());l=new O(m,m.clone().add(b)),h=this.border.intersections(l)}return n.push(l),n}},{key:"update",value:function(e){var n=this;if(this.timings.updateStartTime=S(),this.controller.pressed())if(this.keyboard=Object.assign({},this.controller.mouse),this.controller.keyboardModeSwitch.mode2){var i=0;(this.controller.up||this.controller.left)&&(i=-1),(this.controller.down||this.controller.right)&&(i=1),i&&this.direction.rotate(e*i*.003)}else{var a=new P;if(this.controller.up&&a.add(new P(0,-1)),this.controller.down&&a.add(new P(0,1)),this.controller.left&&a.add(new P(-1,0)),this.controller.right&&a.add(new P(1,0)),a.magnitude()){var s=Math.atan2(this.direction.x*a.y-a.x*this.direction.y,this.direction.x*a.x+this.direction.y*a.y),r=e*Math.sign(s)*.003;this.direction.rotate(Math.abs(r)>Math.abs(s)?s:r)}}else this.controller.mouse?(!this.keyboard||this.keyboard.x!==this.controller.mouse.x&&this.keyboard.y!==this.controller.mouse.y)&&(this.keyboard=null,this.direction=new P(this.controller.mouse.x,this.controller.mouse.y).sub(new P(this.view.width/2,this.view.height/2)).normalize()):!this.keyboard&&this.controller.lastMouse&&(this.direction=new P(this.controller.lastMouse.x,this.controller.lastMouse.y).sub(new P(this.view.width/2,this.view.height/2)).normalize());var o=this.player;if(this.timings.aiStartTime=S(),this.units.forEach((function(t){return t.update(n)})),this.timings.aiEndTime=S(),this.units.slice().forEach((function(i){if(!i.death)for(var a=n.getMovement(e,i),s=function(){if(i.death)return{v:void 0};var t=a.shift(),e=n.space.intersections(t),s=[];e.forEach((function(t){var e=s.findIndex((function(e){return e.point.equal(t.point)}));if(-1===e)s.push({point:t.point,intersections:[t]});else{if(t.point!==s[e].point)if(t.point.cell){if(s[e].point.cell)throw new Error("Бывает ли такое?");s[e].point=t.point,s[e].intersections.forEach((function(e){e.point=t.point}))}else t.point=s[e].point;s[e].intersections.push(t)}})),e.forEach((function(e){e.distance=t.start.distance2(e.point)})),e.sort((function(t,e){return t.distance-e.distance}));var r=[],o=null,l=-1;if(e.forEach((function(t){b(t.distance,l)||(o=[],l=t.distance,r.push(o)),o.push(t)})),r.forEach((function(e){var a=[];e.forEach((function(t){var e=t.segment.shape;e&&-1===a.indexOf(e)&&a.push(e)}));for(var s=function(){var s=a.findIndex((function(t){return t.owner===i.in}));if(0<s){var r=a[0];a[0]=a[s],a[s]=r}var o=a.findIndex((function(t){return t.owner.isTrack}));if(0<o){var l=a[0];a[0]=a[o],a[o]=l}var h=a.shift(),c=[];for(e.forEach((function(t){t.segment.shape===h&&c.push(t)}));!i.death&&c.length;){c.sort((function(t,e){return i.in?e.zn-t.zn:t.zn-e.zn}));var u=c.shift();u.segment.shape&&!h.owner.unit.death&&h.owner.handleIntersect(u,i,t,n)}};a.length;)s()})),i.death)return{v:void 0};var h=t.end;if(i.in!==i.base&&i.track.polyline.add(h),i.position=h,n.generateParticles&&!a.length&&i.in&&i.in!==i.base){var c=Math.sign(Math.random()-.5),u=i.skin.avatar.scale*v,d=t.vector.clone().normalize().rotate(c*Math.random()*(Math.PI/30)).mulScalar(3*F.unitSpeed+Math.random()*F.unitSpeed),f=t.vector.clone().rotate(Math.PI/2).normalize().mulScalar(c*Math.random()*u/2),p=t.vector.clone().normalize().mulScalar(u/2),m=t.vector.clone().normalize().mulScalar(-6*F.unitSpeed),y=["#fff","#000","#fff","#000"],g=15*Math.random(),k=new D(y[~~(Math.random()*y.length)],t.start.clone().add(f).add(p).add(new P(0,-F.baseHeight)),d,Math.PI+Math.random()*Math.PI,g,-3*g,650,m);n.particles.push(k)}};a.length;){var r=s();if("object"===t(r))return r.v}})),o){var l=(o.base.square-o.lastSquare)/this.square*100;o.lastSquare=o.base.square,.01<=l&&this.labels.push(new R("+".concat(l.toFixed(2),"%"),o.skin.colors.back,o,new P(0,-155),new P(0,-180),1e3,!0))}this.units.sort((function(t,e){return e.base.square-t.base.square})),this.labels=this.labels.filter((function(t){return t.update(e),0<t.time})),this.particles=this.particles.filter((function(t){return t.update(e),0<t.time}));var h=(o?p-o.base.square/this.square*(p-m):.5)-this.scale;this.scale+=h*e/80,o&&.9999<o.base.square/this.square&&this.gameOver(!0),this.timings.spawnStartTime=S(),this.units.length<this.maxUnits&&this.spawnBot(.3<Math.random()),this.timings.spawnEndTime=S(),this.timings.updateEndTime=S()}},{key:"render",value:function(t){var e=this;this.timings.renderStartTime=S();var n=this.view;if(n){var i=document.getElementById("minimap"),a=i.getContext("2d");i.width=180,i.height=180,d=window.devicePixelRatio,f=n.width*d,p=n.height*d,m=Math.sqrt(f*f+p*p)/Math.sqrt(2455780),y=.0112,g=this.player?this.player.position:this.space.center,k=0,b=0,w=g.x-n.width/2/y,_=g.x+n.width/2/y,T=g.y-n.height/2/y,E=g.y+n.height/2/y,q=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return x(w-e,_+e,t.x)&&x(T-e,E+e,t.y)},P=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return 0<M(t.bounds.left-e,t.bounds.right+e,w,_)&&0<M(t.bounds.top-e,t.bounds.bottom+e,T,E)},a.resetTransform(),a.clearRect(0,0,n.width,n.height),a.translate(-k,-b),a.scale(y,y),a.translate(0,-F.baseHeight),a.lineCap="round",a.globalCompositeOperation="destination-out",this.units.forEach((function(t){var e=t.track.polyline;e.start;e.bounds})),a.translate(0,F.baseHeight),a.globalCompositeOperation="source-over",a.globalCompositeOperation="destination-over",this.units.forEach((function(t){q(t.position,4*v)&&(a.save(),t.skin.avatar.bottomLayers.forEach((function(e){return J(a,t,e)})),a.restore())})),a.globalAlpha=.6,this.units.forEach((function(t){t.in!==t.base&&P(t.track.polyline,v)&&H(a,t.skin.pattern||t.skin.colors.main,t.track,t.position)})),a.globalAlpha=1,this.units.forEach((function(t){P(t.base.polygon,v)&&W(a,t.base.polygon.path,t.skin&&t.skin.back||t.skin.colors.back)})),K(a,this.border,0,"#fff"),a.translate(0,-5),a.fillRect(f/-2,p/-2,this.space.width+f,this.space.height+p),a.lineJoin="round",a.globalCompositeOperation="source-over",a.lineJoin="butt",a.lineCap="butt",a.scale(1/y,1/y),this.labels.forEach((function(t){})),a.scale(y,y),(h=this.units[0])&&function(t,e,n){var i=window.devicePixelRatio,a=~~(20/i);t.save(),t.translate(e.position.x,e.position.y),t.scale(1/(n*i*2),1/(n*i*2)),t.fillStyle="#ffff00",t.strokeStyle="#111",t.lineJoin="round",t.lineWidth=4,t.translate(0,-10*n*i),t.translate(0,-4),t.translate(0,-a*i),t.translate(0,-20),t.fill(U),t.stroke(U),t.restore()}(a,h,y);var s=h&&h.base.square/this.square;a.resetTransform(),a.scale(1/d,1/d),this.timings.renderEndTime=S();var r=function(t,e){return.95*t+.05*e},o=this.stats,l=this.timings;o.fps=r(o.fps,1e3/t),o.ut=r(o.ut,l.updateEndTime-l.updateStartTime),o.ait=r(o.ait,l.aiEndTime-l.aiStartTime),o.st=r(o.st,l.spawnEndTime-l.spawnStartTime),o.rt=r(o.rt,l.renderEndTime-l.renderStartTime)}if(n){var h,c=n.getContext("2d"),d=window.devicePixelRatio,f=n.width*d,p=n.height*d,m=Math.sqrt(f*f+p*p)/Math.sqrt(2455780),y=this.scale*m/d,g=this.player?this.player.position:this.space.center,k=g.x*y-n.width/2,b=g.y*y-n.height/2,w=g.x-n.width/2/y,_=g.x+n.width/2/y,T=g.y-n.height/2/y,E=g.y+n.height/2/y,q=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return x(w-e,_+e,t.x)&&x(T-e,E+e,t.y)},P=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return 0<M(t.bounds.left-e,t.bounds.right+e,w,_)&&0<M(t.bounds.top-e,t.bounds.bottom+e,T,E)};c.resetTransform(),c.clearRect(0,0,n.width,n.height),c.translate(-k,-b),c.scale(y,y),c.translate(0,-F.baseHeight),this.units.forEach((function(t){P(t.base.polygon,v)&&W(c,t.base.polygon.path,t.skin.pattern||t.skin.colors.main)})),c.lineCap="round",c.globalCompositeOperation="destination-out",this.units.forEach((function(t){var e=t.track.polyline,n=e.start;e.bounds,n&&(H(c,"#111",t.track,t.position),c.save(),c.globalCompositeOperation="destination-over",c.clip(t.base.polygon.path),H(c,t.skin.pattern||t.skin.colors.main,t.track,t.position,!0),c.restore())})),c.translate(0,F.baseHeight),c.globalCompositeOperation="source-over",this.units.forEach((function(t){q(t.position,4*v)&&(c.save(),t.skin.avatar.topLayers.forEach((function(e){return J(c,t,e)})),c.restore())})),this.units.forEach((function(t){!function(t,e,n){var i=~~(25/window.devicePixelRatio);t.save(),t.translate(e.position.x,e.position.y),t.scale(1.001/n,1.001/n),t.font="bold ".concat(i,"px arial"),t.shadowColor="black",t.shadowBlur=0,t.lineWidth=5,t.textAlign="center",t.textBaseline="bottom",t.shadowBlur=0,t.textAlign="center",t.textBaseline="bottom",t.strokeText(e.name+"",0,-100*n),t.fillStyle="#fff",t.fillText(e.name+"",0,-100*n),t.restore()}(c,t,y)})),c.globalCompositeOperation="destination-over",this.units.forEach((function(t){q(t.position,4*v)&&(c.save(),t.skin.avatar.bottomLayers.forEach((function(e){return J(c,t,e)})),c.restore())})),c.globalAlpha=.6,this.units.forEach((function(t){t.in!==t.base&&P(t.track.polyline,v)&&H(c,t.skin.pattern||t.skin.colors.main,t.track,t.position)})),c.globalAlpha=1,this.units.forEach((function(t){P(t.base.polygon,v)&&W(c,t.base.polygon.path,t.skin&&t.skin.back||t.skin.colors.back)})),K(c,this.border,0,"#eee"),K(c,this.border,0,"#ff0000"),c.translate(0,-5),c.fillStyle=function(t,e){return u||((u=t.createLinearGradient(e.width/2,0,e.width/2,e.height)).addColorStop(0,"#202020"),u.addColorStop(.5,"#202020"),u.addColorStop(1,"#202020")),u}(c,this.space),c.fillRect(f/-2,p/-2,this.space.width+f,this.space.height+p),c.lineJoin="round",c.globalCompositeOperation="source-over",c.globalCompositeOperation="source-over",c.lineJoin="butt",c.lineCap="butt",this.particles.forEach((function(t){return q(t.position,v)&&t.draw(c)})),c.scale(1/y,1/y),this.labels.forEach((function(t){return t.draw(c,y)})),c.scale(y,y),(h=this.units[0])&&function(t,e,n){var i=window.devicePixelRatio,a=~~(50/i);t.save(),t.translate(e.position.x,e.position.y),t.scale(1/(n*i),1/(n*i)),t.fillStyle="#ffff00",t.strokeStyle="#111",t.lineJoin="round",t.lineWidth=4,t.translate(0,-10*n*i),t.translate(0,-4),t.translate(0,-a*i),t.translate(0,-60),t.fill(U),t.stroke(U),t.restore()}(c,h,y);s=h&&h.base.square/this.square;c.resetTransform();var C=function(t,e,n,i,a,s){var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,a=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(t){a=!0,s=t}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(s,4),o=r[0],l=r[1],h=r[2],c=r[3];t.beginPath(),t.moveTo(e+o,n),t.lineTo(e+i-l,n),t.quadraticCurveTo(e+i,n,e+i,n+l),t.lineTo(e+i,n+a-h),t.quadraticCurveTo(e+i,n+a,e+i-h,n+a),t.lineTo(e+c,n+a),t.quadraticCurveTo(e,n+a,e,n+a-c),t.lineTo(e,n+o),t.quadraticCurveTo(e,n,e+o,n),t.closePath(),t.fill()};c.scale(1/d,1/d);var I=this.view;if(I){d=window.devicePixelRatio;var $=I.width*d,O=I.height*d}for(var z,L=function(t,e,n){return n<t?t:e<n?e:n}(9/16,16/9,f/p),j=f/(-(1.75+1.75*L)/(9/16-16/9)),R=j/2,B=function(t,n,i,a){if($/2<600){var s=16+90*i,r=t.base.square/e.square/a*R;z&&z-.05*R<r&&(r=z-.05*R);var o=f-(R+(z=r));c.fillStyle="#00000011",C(c,o,12+s,j,70,[18,0,0,18]),c.fillStyle=t.skin.colors.back,C(c,o,12+s,j,70,[18,0,0,18]),c.fillStyle=t.skin.colors.main,C(c,o,s,j,70,[18,0,0,18]),c.fillStyle=t.skin.colors.nick,c.font="bold ".concat(40,"px arial"),c.textAlign="left",c.textBaseline="top"}else{s=16+46*i,r=t.base.square/e.square/a*R;z&&z-.05*R<r&&(r=z-.05*R);o=f-(R+(z=r));c.fillStyle="#00000011",C(c,o,16+s,j,36,[18,0,0,18]),c.fillStyle=t.skin.colors.back,C(c,o,4+s,j,36,[18,0,0,18]),c.fillStyle=t.skin.colors.main,C(c,o,s,j,36,[18,0,0,18]),c.fillStyle=t.skin.colors.nick,c.font="bold ".concat(20,"px arial"),c.textAlign="left",c.textBaseline="middle"}1==n?c.fillText("".concat("👑 "+n,"— ").concat((t.base.square/e.square*100).toFixed(2),"% ").concat(t.name),18+o,18+s+2):c.fillText("".concat(n,"— ").concat((t.base.square/e.square*100).toFixed(2),"% ").concat(t.name),18+o,18+s+2)},D=!1,A=0;A<5;A++){var N=this.units[A];N&&(N===this.player&&(D=!0),B(N,A+1,A,s))}if(!D&&this.player&&!this.player.death){var Y=this.units.findIndex((function(t){return t===e.player}));B(this.player,Y+1,6,s)}if(this.player)if($/2<600){c.fillStyle="#00000022",C(c,0,O+300,j,40,[0,20,20,0]);var G=.25*j+this.player.base.square/this.square*j*.75;c.fillStyle=this.player.skin.colors.back,C(c,0,O+300,G,36,[0,18,18,0]),c.fillStyle=this.player.skin.colors.main,C(c,0,O+300,G,36,[0,18,18,0]),c.fillStyle=this.player.skin.colors.nick,c.font="bold ".concat(60,"px arial"),c.textAlign="left",c.textBaseline="middle",c.fillText("🏆 ".concat((this.player.base.square/this.square*100).toFixed(2),"%"),18,60),c.fillStyle="#00000088",c.fillStyle=this.player.skin.colors.nick,c.font="bold ".concat(60,"px arial"),c.textBaseline="middle",c.fillText("💀 ".concat(this.player.statistics.kills),18,140),canliskor=(this.player.base.square/this.square*100).toFixed(2)}else{c.fillStyle="#00000022",C(c,0,16,j,40,[0,20,20,0]);G=.25*j+this.player.base.square/this.square*j*.75;c.fillStyle=this.player.skin.colors.back,C(c,0,20,G,36,[0,18,18,0]),c.fillStyle=this.player.skin.colors.main,C(c,0,14,G,36,[0,18,18,0]),c.fillStyle=this.player.skin.colors.nick,c.font="bold ".concat(22,"px arial"),c.textAlign="left",c.textBaseline="middle",c.fillText("".concat((this.player.base.square/this.square*100).toFixed(2),"%"),18,36),c.fillStyle="#00000088",c.fillStyle="#111",C(c,0,60,170,36,[0,18,18,0]),c.font="bold ".concat(20,"px arial"),c.fillStyle="#fff",c.textBaseline="top",c.fillText("🏆 Best: ".concat(this.best.toFixed(2),"%"),3,70),c.fillStyle="#111",C(c,0,100,130,36,[0,18,18,0]),c.fillStyle="#fff",c.font="bold ".concat(20,"px arial"),c.textBaseline="middle",c.fillText("💀 Kills: ".concat(this.player.statistics.kills),3,120),canliskor=(this.player.base.square/this.square*100).toFixed(2)}this.timings.renderEndTime=S();r=function(t,e){return.95*t+.05*e},o=this.stats,l=this.timings;o.fps=r(o.fps,1e3/t),o.ut=r(o.ut,l.updateEndTime-l.updateStartTime),o.ait=r(o.ait,l.aiEndTime-l.aiStartTime),o.st=r(o.st,l.spawnEndTime-l.spawnStartTime),o.rt=r(o.rt,l.renderEndTime-l.renderStartTime)}}},{key:"checkSegments",value:function(t){this.units.forEach((function(t){t.base.polygon.segments.length,t.track.polyline.segments.length}));var e=this.space.segmentsCount();Object.keys(e).length}},{key:"handleReturn",value:function(e){var n=this;if(!e.death){var i=e.track.polyline.clone(),a=e.base,s=a.polygon.segments.findIndex((function(t){return t.start===i.start})),r=a.polygon.segments.findIndex((function(t){return t.start===i.end})),o=Math.min(r,s),l=Math.max(r,s);o!==s&&i.reverse();var c=i.points(),u=a.polygon.points(),d=u.splice.apply(u,[o,l-o+1].concat(h(c)));d.shift(),d.pop(),d.reverse(),d.push.apply(d,h(c));var f,p=new L(d);p.rawSquare()<0?(f=new L(u.reverse()),a.polygon.unsplice(i,o,l)):(f=p,a.polygon.splice(i,o,l)),a.square+=f.square(),a.polygon.calcPath(),this.units.filter((function(t){return t!==e})).forEach((function(t){t.death||(t.in===t.base&&f.inside(t.position)&&n.kill(t,e),t.track.polyline.start&&f.inside(t.track.polyline.start)&&n.kill(t,e))}));for(var m=[],v=e.track.polyline.segments,y=v.length,g=function(t){var i=t===y?v[t-1].end:v[t].start,a=i.segments.filter((function(t){return t.shape.owner!==e.track&&t.shape.owner!==e.base&&t.start===i}));if(a.length){var s=a.map((function(e){return{owner:e.shape.owner,point:i,segment:e,index:t}}));if(m.length){var r=m.filter((function(t){return s.some((function(e){return e.owner===t.owner}))}));if(r.length){var o=r[0],l=s.find((function(t){return t.owner===o.owner}));!function(t){var i=t.owner,a=t.startT,s=t.endT,r=t.startPoint,o=t.endPoint,l=t.enter,c=t.leave;if(l.shape!==i.polygon&&(l=i.polygon.segments.find((function(t){return t.start===r}))),c.shape!==i.polygon&&(c=i.polygon.segments.find((function(t){return t.start===o}))),l!==c){var u=e.track.polyline.points().splice(a,s-a+1),d=i.polygon.segments.findIndex((function(t){return t===l})),f=i.polygon.segments.findIndex((function(t){return t===c})),p=Math.min(f,d),m=Math.max(f,d);p!==d&&u.reverse();var v=i.polygon.points(),y=v.splice.apply(v,[p,m-p+1].concat(h(u)));y.shift(),y.pop(),y.push.apply(y,h(u.slice().reverse()));var g,k=new L(y),b=new L(v);g=i.unit.in===i.unit.base&&k.inside(i.unit.position)||i.unit.in!==i.unit.base&&k.inside(i.unit.track.polyline.start)?(i.polygon.right(u,p,m),b):(i.polygon.left(u,p,m),k),i.square-=g.square(),i.polygon.calcPath(),n.units.forEach((function(t){i.unit!==t&&t.in===i&&g.inside(t.position)&&(t.in=null)}))}}({owner:o.owner,enter:o.segment,startPoint:o.point,startT:o.index,leave:l.segment,endPoint:l.point,endT:l.index});var c=e.track.intersections.find((function(t){return t.point.equal(i)})).intersections.filter((function(t){return t.base===o.owner}));1!==c.length&&!1!==c[c.length-1].enter||(s=s.filter((function(t){return t.owner!==o.owner})))}m=s}else{var u=e.track.intersections.find((function(t){return t.point.equal(i)}));if(!u)return{v:!1};m=s.filter((function(t){var e=u.intersections.filter((function(e){return e.base===t.owner}));return!!e.length&&e[e.length-1].enter}))}}},k=0;k<=y;k++){var b=g(k);if("object"===t(b))return b.v}this.units.forEach((function(t){e!==t&&f.inside(t.position)&&(t.in=e.base)}))}}}]),n}(),st=F.trackWidth*F.maxScale,rt={level:0,scale:1,x:0,y:0,pivot:{x:.5,y:.5},direction:"",rotation:0,image:null},ot={scale:1,x:0,y:0,layers:[]},lt={main:"black",back:"black",nick:"black",particles:["black"]},ht={name:"",colors:lt,pattern:null,avatar:null},ct=document.createElementNS("http://www.w3.org/2000/svg","svg"),ut=function t(n,i,a){var s=this;if(e(this,t),Object.assign(this,ht,i),this.colors=Object.assign({},lt,i.colors),this.pattern=null,i.pattern){var r=new Image;r.onload=function(){var t=r.width,e=r.height,a=500/t*F.maxScale*(i.pattern.scale||1),o=document.createElement("canvas");o.width=~~(t*a),o.height=~~(e*a),o.getContext("2d").drawImage(r,0,0,o.width,o.height),s.pattern=n.getContext("2d").createPattern(o,"repeat");var l=1/F.maxScale,h=ct.createSVGMatrix().scale(l,l);s.pattern.setTransform&&s.pattern.setTransform(h)},r.src=a+i.pattern.url}var o=function(t,e){var n=document.createElement("canvas");n.width=st,n.height=st;var i=n.getContext("2d");return i.fillStyle=e,i.fillRect(0,0,st,st),i.fillStyle=t,i.fillRect(st/6,st/6,2/3*st,2/3*st),n};i.avatar?(this.avatar=Object.assign({},ot,i.avatar),this.avatar.layers=(i.avatar.layers||[]).map((function(t){var e=Object.assign({},rt,t);e.pivot=Object.assign({x:.5,y:.5},t.pivot);var n=new Image;return n.src=a+e.url,n.onload=function(){var t=n.naturalWidth||n.width,i=n.naturalHeight||n.height,a=st*s.avatar.scale*e.scale/t,r=~~(t*a),o=~~(i*a),l=document.createElement("canvas");l.width=r,l.height=o,l.getContext("2d").drawImage(n,0,0,r,o),e.image=l},e}))):this.avatar=Object.assign({},ot,{layers:[Object.assign({},rt,{image:o(this.colors.back,this.colors.back)}),Object.assign({},rt,{level:1,image:o(this.colors.main,this.colors.back)})]}),this.avatar.topLayers=this.avatar.layers.filter((function(t){return 1<=t.level})).sort((function(t,e){return t.level-e.level})),this.avatar.bottomLayers=this.avatar.layers.filter((function(t){return t.level<1})).sort((function(t,e){return e.level-t.level}))},dt=function(){function t(n){var i=this;e(this,t),this.view=n,this.available=[],this.used=[],[0,30,60,120,175,200,220,240,260,280,320].forEach((function(t){var e=q(t,70,100),a=q(t,70,95),s=q(t,70,80),r=q(t,70,60);i.available.push(new ut(n,{colors:{main:a,back:s,nick:r,particles:[e,a,s,r]}}))}))}return i(t,[{key:"add",value:function(t,e){var n=this;t.forEach((function(t){return n.available.push(new ut(n.view,t,e))}))}},{key:"get",value:function(t,e){"default"===t&&(t="");var n,i=this.available.length;if(!i)throw new Error("Запас скинов исчерпан");if(t)n=this.available.findIndex((function(e){return e.name===t}));else if(e){var a=this.available.filter((function(e){return e.name===t})),s=a[~~(Math.random()*a.length)];n=this.available.indexOf(s)}else n=~~(Math.random()*i);if(0<=n){var r=this.available.splice(n,1)[0];return this.used.push(r),r}}},{key:"release",value:function(t){var e=this.used.indexOf(t);-1!==e&&this.used.splice(e,1),this.available.push(t)}}]),t}(),ft=function(){function t(n){e(this,t),this.pool=[],this.requested=!1,this.callback=function(){return n&&n.prepare()}}return i(t,[{key:"get",value:function(){return this.pool.shift()}},{key:"request",value:function(){var t=this;if(!this.requested){this.requested=!0;var e=10-this.pool.length;$.ajax({url:"paper2.php",method:"POST",data:{length:e},success:function(e){t.requested=!1,t.pool=t.pool.concat(e.names),t.callback&&(t.callback(),t.callback=null)},error:function(e,n,i){t.requested=!1}})}}}]),t}(),pt=function(){function t(){e(this,t),this.mode2=!1}return i(t,[{key:"get",value:function(){return"undefined"!=typeof Cookies&&void 0!==Cookies.get("paper2_keyboard_mode2")&&(this.mode2="true"===Cookies.get("paper2_keyboard_mode2")),this.mode2}},{key:"switch",value:function(){this.mode2=!this.mode2,"undefined"!=typeof Cookies&&Cookies.set("paper2_keyboard_mode2",this.mode2)}}]),t}();if("paperio.cafe"==window.location.host)if(Path2D){var mt=new I(16e3,16e3,100);P.space=mt;var vt=new P(8e3,8e3),yt=.95*Math.min(vt.x,vt.y),gt=new j(E(vt.x,vt.y,300,yt),yt),kt={},bt=0,wt=function(t){var e=t.game,n=t.score,i=t.best,a=(t.time,t.kills,t.image,t.win);t.newBest=!1,i<n&&("undefined"!=typeof Cookies&&Cookies.set("paper3_best",n),t.newBest=!0,t.best=n),a&&(bt=0,kt.prepare()),e.view.style.display="none",e.generateParticles=!1,e.actived=!1,window.paper2_results=t,window.game_is_over_main()},xt=((y=document.createElement("canvas")).style.display="none",y.style.width="100%",y.style.height="100%",y.style.position="absolute",y.style.top="50%",y.style.left="50%",y.style.transform="translate(-50%, -50%)",document.body.appendChild(y),y),Mt=new ft(kt),_t=new dt(xt),St=new pt;$.ajax({url:"skins/skins.json",method:"GET",success:function(t){Mt.request(),_t.add(t,"skins/");var e,n,i=new at(xt,mt,gt,_t,10,wt,Mt,St),a=!1,s=F.spawnTimeout;F.spawnTimeout=0,kt.prepare=function(){e=setInterval((function(){Mt.pool.length&&(i.update(1e3/60*2+Math.random()),++bt>F.prepareCounter&&clearInterval(e))}),1e3/60)},kt.start=function(){for(i.best="undefined"!=typeof Cookies&&Cookies.get("paper3_best")?parseFloat(Cookies.get("paper3_best")):0,i.view.style.display="block",i.controller.keyboardModeSwitch.get(),clearInterval(e);bt<F.prepareCounter;bt++)i.update(1e3/60*2+Math.random());F.spawnTimeout=s,i.spawnPlayer("undefined"!=typeof Cookies&&Cookies.get("myNick"),Cookies.get("mySkin")),i.generateParticles=!0,i.actived=!0,a||(a=!0,n=performance.now()-1e3/60,function t(){var e=performance.now(),a=e-n;!i.actived&&500<a&&(a=1e3/60+Math.random());for(var s=a;0<a;)if(2e3/60<a){var r=Math.random()+2e3/60;a-r<1e3/60&&(r=Math.random()+25),a-=r,i.update(r)}else i.update(a),a=0;i.actived&&i.render(s),n=e,requestAnimationFrame(t)}())},window.paper2=kt}})}else window.paper2={noSupport:!0};else alert("server error!")}();